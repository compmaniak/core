<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - Dovecot coverage - lib/sha1.c</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">lib</a> - sha1.c<span style="font-size: 80%;"> (source / <a href="sha1.c.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">Dovecot coverage</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">134</td>
            <td class="headerCovTableEntry">134</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2021-02-24</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">9</td>
            <td class="headerCovTableEntry">9</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
</td>
            <td></td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*  $KAME: sha1.c,v 1.5 2000/11/08 06:13:08 itojun Exp $    */</a>
<span class="lineNum">       2 </span>            : /*
<span class="lineNum">       3 </span>            :  * Copyright (C) 1995, 1996, 1997, and 1998 WIDE Project.
<span class="lineNum">       4 </span>            :  * All rights reserved.
<span class="lineNum">       5 </span>            :  *
<span class="lineNum">       6 </span>            :  * Redistribution and use in source and binary forms, with or without
<span class="lineNum">       7 </span>            :  * modification, are permitted provided that the following conditions
<span class="lineNum">       8 </span>            :  * are met:
<span class="lineNum">       9 </span>            :  * 1. Redistributions of source code must retain the above copyright
<span class="lineNum">      10 </span>            :  *    notice, this list of conditions and the following disclaimer.
<span class="lineNum">      11 </span>            :  * 2. Redistributions in binary form must reproduce the above copyright
<span class="lineNum">      12 </span>            :  *    notice, this list of conditions and the following disclaimer in the
<span class="lineNum">      13 </span>            :  *    documentation and/or other materials provided with the distribution.
<span class="lineNum">      14 </span>            :  * 3. Neither the name of the project nor the names of its contributors
<span class="lineNum">      15 </span>            :  *    may be used to endorse or promote products derived from this software
<span class="lineNum">      16 </span>            :  *    without specific prior written permission.
<span class="lineNum">      17 </span>            :  *
<span class="lineNum">      18 </span>            :  * THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND
<span class="lineNum">      19 </span>            :  * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
<span class="lineNum">      20 </span>            :  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
<span class="lineNum">      21 </span>            :  * ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE
<span class="lineNum">      22 </span>            :  * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
<span class="lineNum">      23 </span>            :  * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
<span class="lineNum">      24 </span>            :  * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
<span class="lineNum">      25 </span>            :  * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
<span class="lineNum">      26 </span>            :  * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
<span class="lineNum">      27 </span>            :  * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
<span class="lineNum">      28 </span>            :  * SUCH DAMAGE.
<span class="lineNum">      29 </span>            :  */
<span class="lineNum">      30 </span>            : 
<span class="lineNum">      31 </span>            : /*
<span class="lineNum">      32 </span>            :  * FIPS pub 180-1: Secure Hash Algorithm (SHA-1)
<span class="lineNum">      33 </span>            :  * based on: http://csrc.nist.gov/fips/fip180-1.txt
<span class="lineNum">      34 </span>            :  * implemented by Jun-ichiro itojun Itoh &lt;itojun@itojun.org&gt;
<span class="lineNum">      35 </span>            :  */
<span class="lineNum">      36 </span>            : 
<span class="lineNum">      37 </span>            : #include &quot;lib.h&quot;
<span class="lineNum">      38 </span>            : #include &quot;sha1.h&quot;
<span class="lineNum">      39 </span>            : #include &quot;safe-memset.h&quot;
<span class="lineNum">      40 </span>            : 
<span class="lineNum">      41 </span>            : /* constant table */
<span class="lineNum">      42 </span>            : static uint32_t SHA1_K[] = { 0x5a827999, 0x6ed9eba1, 0x8f1bbcdc, 0xca62c1d6 };
<span class="lineNum">      43 </span>            : #define K(t)    SHA1_K[(t) / 20]
<span class="lineNum">      44 </span>            : 
<span class="lineNum">      45 </span>            : #define F0(b, c, d) (((b) &amp; (c)) | ((~(b)) &amp; (d)))
<span class="lineNum">      46 </span>            : #define F1(b, c, d) (((b) ^ (c)) ^ (d))
<span class="lineNum">      47 </span>            : #define F2(b, c, d) (((b) &amp; (c)) | ((b) &amp; (d)) | ((c) &amp; (d)))
<span class="lineNum">      48 </span>            : #define F3(b, c, d) (((b) ^ (c)) ^ (d))
<span class="lineNum">      49 </span>            : 
<span class="lineNum">      50 </span>            : #define S(n, x)     (((x) &lt;&lt; (n)) | ((x) &gt;&gt; (32 - n)))
<span class="lineNum">      51 </span>            : 
<span class="lineNum">      52 </span>            : #define H(n)    (ctxt-&gt;h.b32[(n)])
<span class="lineNum">      53 </span>            : #define COUNT   (ctxt-&gt;count)
<span class="lineNum">      54 </span>            : #define BCOUNT  (ctxt-&gt;c.b64[0] / 8)
<span class="lineNum">      55 </span>            : #define W(n)    (ctxt-&gt;m.b32[(n)])
<span class="lineNum">      56 </span>            : 
<span class="lineNum">      57 </span>            : #define PUTBYTE(x)  { \
<span class="lineNum">      58 </span>            :     ctxt-&gt;m.b8[(COUNT % 64)] = (x);      \
<span class="lineNum">      59 </span>            :     COUNT++;                \
<span class="lineNum">      60 </span>            :     COUNT %= 64;                \
<span class="lineNum">      61 </span>            :     ctxt-&gt;c.b64[0] += 8;         \
<span class="lineNum">      62 </span>            :     if (COUNT % 64 == 0)            \
<span class="lineNum">      63 </span>            :         sha1_step(ctxt);        \
<span class="lineNum">      64 </span>            :      }
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span>            : #define PUTPAD(x)   { \
<span class="lineNum">      67 </span>            :     ctxt-&gt;m.b8[(COUNT % 64)] = (x);      \
<span class="lineNum">      68 </span>            :     COUNT++;                \
<span class="lineNum">      69 </span>            :     COUNT %= 64;                \
<span class="lineNum">      70 </span>            :     if (COUNT % 64 == 0)            \
<span class="lineNum">      71 </span>            :         sha1_step(ctxt);        \
<span class="lineNum">      72 </span>            :      }
<span class="lineNum">      73 </span>            : 
<span class="lineNum">      74 </span>            : static void sha1_step(struct sha1_ctxt *);
<a name="75"><span class="lineNum">      75 </span>            : </a>
<span class="lineNum">      76 </span>            : static void ATTR_UNSIGNED_WRAPS
<span class="lineNum">      77 </span><span class="lineCov">     905518 : sha1_step(struct sha1_ctxt *ctxt)</span>
<span class="lineNum">      78 </span>            : {
<span class="lineNum">      79 </span>            :     uint32_t    a, b, c, d, e;
<span class="lineNum">      80 </span>            :     size_t t, s;
<span class="lineNum">      81 </span>            :     uint32_t    tmp;
<span class="lineNum">      82 </span>            : 
<span class="lineNum">      83 </span>            : #ifndef WORDS_BIGENDIAN
<span class="lineNum">      84 </span>            :     struct sha1_ctxt tctxt;
<span class="lineNum">      85 </span><span class="lineCov">     905518 :     memmove(&amp;tctxt.m.b8[0], &amp;ctxt-&gt;m.b8[0], 64);</span>
<span class="lineNum">      86 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[0] = tctxt.m.b8[3]; ctxt-&gt;m.b8[1] = tctxt.m.b8[2];</span>
<span class="lineNum">      87 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[2] = tctxt.m.b8[1]; ctxt-&gt;m.b8[3] = tctxt.m.b8[0];</span>
<span class="lineNum">      88 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[4] = tctxt.m.b8[7]; ctxt-&gt;m.b8[5] = tctxt.m.b8[6];</span>
<span class="lineNum">      89 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[6] = tctxt.m.b8[5]; ctxt-&gt;m.b8[7] = tctxt.m.b8[4];</span>
<span class="lineNum">      90 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[8] = tctxt.m.b8[11]; ctxt-&gt;m.b8[9] = tctxt.m.b8[10];</span>
<span class="lineNum">      91 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[10] = tctxt.m.b8[9]; ctxt-&gt;m.b8[11] = tctxt.m.b8[8];</span>
<span class="lineNum">      92 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[12] = tctxt.m.b8[15]; ctxt-&gt;m.b8[13] = tctxt.m.b8[14];</span>
<span class="lineNum">      93 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[14] = tctxt.m.b8[13]; ctxt-&gt;m.b8[15] = tctxt.m.b8[12];</span>
<span class="lineNum">      94 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[16] = tctxt.m.b8[19]; ctxt-&gt;m.b8[17] = tctxt.m.b8[18];</span>
<span class="lineNum">      95 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[18] = tctxt.m.b8[17]; ctxt-&gt;m.b8[19] = tctxt.m.b8[16];</span>
<span class="lineNum">      96 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[20] = tctxt.m.b8[23]; ctxt-&gt;m.b8[21] = tctxt.m.b8[22];</span>
<span class="lineNum">      97 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[22] = tctxt.m.b8[21]; ctxt-&gt;m.b8[23] = tctxt.m.b8[20];</span>
<span class="lineNum">      98 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[24] = tctxt.m.b8[27]; ctxt-&gt;m.b8[25] = tctxt.m.b8[26];</span>
<span class="lineNum">      99 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[26] = tctxt.m.b8[25]; ctxt-&gt;m.b8[27] = tctxt.m.b8[24];</span>
<span class="lineNum">     100 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[28] = tctxt.m.b8[31]; ctxt-&gt;m.b8[29] = tctxt.m.b8[30];</span>
<span class="lineNum">     101 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[30] = tctxt.m.b8[29]; ctxt-&gt;m.b8[31] = tctxt.m.b8[28];</span>
<span class="lineNum">     102 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[32] = tctxt.m.b8[35]; ctxt-&gt;m.b8[33] = tctxt.m.b8[34];</span>
<span class="lineNum">     103 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[34] = tctxt.m.b8[33]; ctxt-&gt;m.b8[35] = tctxt.m.b8[32];</span>
<span class="lineNum">     104 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[36] = tctxt.m.b8[39]; ctxt-&gt;m.b8[37] = tctxt.m.b8[38];</span>
<span class="lineNum">     105 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[38] = tctxt.m.b8[37]; ctxt-&gt;m.b8[39] = tctxt.m.b8[36];</span>
<span class="lineNum">     106 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[40] = tctxt.m.b8[43]; ctxt-&gt;m.b8[41] = tctxt.m.b8[42];</span>
<span class="lineNum">     107 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[42] = tctxt.m.b8[41]; ctxt-&gt;m.b8[43] = tctxt.m.b8[40];</span>
<span class="lineNum">     108 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[44] = tctxt.m.b8[47]; ctxt-&gt;m.b8[45] = tctxt.m.b8[46];</span>
<span class="lineNum">     109 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[46] = tctxt.m.b8[45]; ctxt-&gt;m.b8[47] = tctxt.m.b8[44];</span>
<span class="lineNum">     110 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[48] = tctxt.m.b8[51]; ctxt-&gt;m.b8[49] = tctxt.m.b8[50];</span>
<span class="lineNum">     111 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[50] = tctxt.m.b8[49]; ctxt-&gt;m.b8[51] = tctxt.m.b8[48];</span>
<span class="lineNum">     112 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[52] = tctxt.m.b8[55]; ctxt-&gt;m.b8[53] = tctxt.m.b8[54];</span>
<span class="lineNum">     113 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[54] = tctxt.m.b8[53]; ctxt-&gt;m.b8[55] = tctxt.m.b8[52];</span>
<span class="lineNum">     114 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[56] = tctxt.m.b8[59]; ctxt-&gt;m.b8[57] = tctxt.m.b8[58];</span>
<span class="lineNum">     115 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[58] = tctxt.m.b8[57]; ctxt-&gt;m.b8[59] = tctxt.m.b8[56];</span>
<span class="lineNum">     116 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[60] = tctxt.m.b8[63]; ctxt-&gt;m.b8[61] = tctxt.m.b8[62];</span>
<span class="lineNum">     117 </span><span class="lineCov">     905518 :     ctxt-&gt;m.b8[62] = tctxt.m.b8[61]; ctxt-&gt;m.b8[63] = tctxt.m.b8[60];</span>
<span class="lineNum">     118 </span>            : #endif
<span class="lineNum">     119 </span>            : 
<span class="lineNum">     120 </span><span class="lineCov">     905518 :     a = H(0); b = H(1); c = H(2); d = H(3); e = H(4);</span>
<span class="lineNum">     121 </span>            : 
<span class="lineNum">     122 </span><span class="lineCov">   19015878 :     for (t = 0; t &lt; 20; t++) {</span>
<span class="lineNum">     123 </span><span class="lineCov">   18110360 :         s = t &amp; 0x0f;</span>
<span class="lineNum">     124 </span><span class="lineCov">   18110360 :         if (t &gt;= 16) {</span>
<span class="lineNum">     125 </span><span class="lineCov">    3622072 :             W(s) = S(1, W((s+13) &amp; 0x0f) ^ W((s+8) &amp; 0x0f) ^ W((s+2) &amp; 0x0f) ^ W(s));</span>
<span class="lineNum">     126 </span>            :         }
<span class="lineNum">     127 </span><span class="lineCov">   18110360 :         tmp = S(5, a) + F0(b, c, d) + e + W(s) + K(t);</span>
<span class="lineNum">     128 </span><span class="lineCov">   18110360 :         e = d; d = c; c = S(30, b); b = a; a = tmp;</span>
<span class="lineNum">     129 </span>            :     }
<span class="lineNum">     130 </span><span class="lineCov">   19015878 :     for (t = 20; t &lt; 40; t++) {</span>
<span class="lineNum">     131 </span><span class="lineCov">   18110360 :         s = t &amp; 0x0f;</span>
<span class="lineNum">     132 </span><span class="lineCov">   18110360 :         W(s) = S(1, W((s+13) &amp; 0x0f) ^ W((s+8) &amp; 0x0f) ^ W((s+2) &amp; 0x0f) ^ W(s));</span>
<span class="lineNum">     133 </span><span class="lineCov">   18110360 :         tmp = S(5, a) + F1(b, c, d) + e + W(s) + K(t);</span>
<span class="lineNum">     134 </span><span class="lineCov">   18110360 :         e = d; d = c; c = S(30, b); b = a; a = tmp;</span>
<span class="lineNum">     135 </span>            :     }
<span class="lineNum">     136 </span><span class="lineCov">   19015878 :     for (t = 40; t &lt; 60; t++) {</span>
<span class="lineNum">     137 </span><span class="lineCov">   18110360 :         s = t &amp; 0x0f;</span>
<span class="lineNum">     138 </span><span class="lineCov">   18110360 :         W(s) = S(1, W((s+13) &amp; 0x0f) ^ W((s+8) &amp; 0x0f) ^ W((s+2) &amp; 0x0f) ^ W(s));</span>
<span class="lineNum">     139 </span><span class="lineCov">   18110360 :         tmp = S(5, a) + F2(b, c, d) + e + W(s) + K(t);</span>
<span class="lineNum">     140 </span><span class="lineCov">   18110360 :         e = d; d = c; c = S(30, b); b = a; a = tmp;</span>
<span class="lineNum">     141 </span>            :     }
<span class="lineNum">     142 </span><span class="lineCov">   19015878 :     for (t = 60; t &lt; 80; t++) {</span>
<span class="lineNum">     143 </span><span class="lineCov">   18110360 :         s = t &amp; 0x0f;</span>
<span class="lineNum">     144 </span><span class="lineCov">   18110360 :         W(s) = S(1, W((s+13) &amp; 0x0f) ^ W((s+8) &amp; 0x0f) ^ W((s+2) &amp; 0x0f) ^ W(s));</span>
<span class="lineNum">     145 </span><span class="lineCov">   18110360 :         tmp = S(5, a) + F3(b, c, d) + e + W(s) + K(t);</span>
<span class="lineNum">     146 </span><span class="lineCov">   18110360 :         e = d; d = c; c = S(30, b); b = a; a = tmp;</span>
<span class="lineNum">     147 </span>            :     }
<span class="lineNum">     148 </span>            : 
<span class="lineNum">     149 </span><span class="lineCov">     905518 :     H(0) = H(0) + a;</span>
<span class="lineNum">     150 </span><span class="lineCov">     905518 :     H(1) = H(1) + b;</span>
<span class="lineNum">     151 </span><span class="lineCov">     905518 :     H(2) = H(2) + c;</span>
<span class="lineNum">     152 </span><span class="lineCov">     905518 :     H(3) = H(3) + d;</span>
<span class="lineNum">     153 </span><span class="lineCov">     905518 :     H(4) = H(4) + e;</span>
<span class="lineNum">     154 </span>            : 
<span class="lineNum">     155 </span><span class="lineCov">     905518 :     memset(&amp;ctxt-&gt;m.b8[0], 0, 64);</span>
<span class="lineNum">     156 </span><span class="lineCov">     905518 : }</span>
<span class="lineNum">     157 </span>            : 
<span class="lineNum">     158 </span>            : /*------------------------------------------------------------*/
<a name="159"><span class="lineNum">     159 </span>            : </a>
<span class="lineNum">     160 </span>            : void
<span class="lineNum">     161 </span><span class="lineCov">     112006 : sha1_init(struct sha1_ctxt *ctxt)</span>
<span class="lineNum">     162 </span>            : {
<span class="lineNum">     163 </span><span class="lineCov">     112006 :     memset(ctxt, 0, sizeof(struct sha1_ctxt));</span>
<span class="lineNum">     164 </span><span class="lineCov">     112006 :     H(0) = 0x67452301;</span>
<span class="lineNum">     165 </span><span class="lineCov">     112006 :     H(1) = 0xefcdab89;</span>
<span class="lineNum">     166 </span><span class="lineCov">     112006 :     H(2) = 0x98badcfe;</span>
<span class="lineNum">     167 </span><span class="lineCov">     112006 :     H(3) = 0x10325476;</span>
<span class="lineNum">     168 </span><span class="lineCov">     112006 :     H(4) = 0xc3d2e1f0;</span>
<span class="lineNum">     169 </span><span class="lineCov">     112006 : }</span>
<a name="170"><span class="lineNum">     170 </span>            : </a>
<span class="lineNum">     171 </span>            : void
<span class="lineNum">     172 </span><span class="lineCov">     111838 : sha1_pad(struct sha1_ctxt *ctxt)</span>
<span class="lineNum">     173 </span>            : {
<span class="lineNum">     174 </span>            :     size_t padlen;      /*pad length in bytes*/
<span class="lineNum">     175 </span>            :     size_t padstart;
<span class="lineNum">     176 </span>            : 
<span class="lineNum">     177 </span><span class="lineCov">     111838 :     PUTPAD(0x80);</span>
<span class="lineNum">     178 </span>            : 
<span class="lineNum">     179 </span><span class="lineCov">     111838 :     padstart = COUNT % 64;</span>
<span class="lineNum">     180 </span><span class="lineCov">     111838 :     padlen = 64 - padstart;</span>
<span class="lineNum">     181 </span><span class="lineCov">     111838 :     if (padlen &lt; 8) {</span>
<span class="lineNum">     182 </span><span class="lineCov">          1 :         memset(&amp;ctxt-&gt;m.b8[padstart], 0, padlen);</span>
<span class="lineNum">     183 </span><span class="lineCov">          1 :         COUNT += padlen;</span>
<span class="lineNum">     184 </span><span class="lineCov">          1 :         COUNT %= 64;</span>
<span class="lineNum">     185 </span><span class="lineCov">          1 :         sha1_step(ctxt);</span>
<span class="lineNum">     186 </span><span class="lineCov">          1 :         padstart = COUNT % 64;  /* should be 0 */</span>
<span class="lineNum">     187 </span><span class="lineCov">          1 :         padlen = 64 - padstart; /* should be 64 */</span>
<span class="lineNum">     188 </span>            :     }
<span class="lineNum">     189 </span><span class="lineCov">     111838 :     memset(&amp;ctxt-&gt;m.b8[padstart], 0, padlen - 8);</span>
<span class="lineNum">     190 </span><span class="lineCov">     111838 :     COUNT += (padlen - 8);</span>
<span class="lineNum">     191 </span><span class="lineCov">     111838 :     COUNT %= 64;</span>
<span class="lineNum">     192 </span>            : #ifdef WORDS_BIGENDIAN
<span class="lineNum">     193 </span>            :     PUTPAD(ctxt-&gt;c.b8[0]); PUTPAD(ctxt-&gt;c.b8[1]);
<span class="lineNum">     194 </span>            :     PUTPAD(ctxt-&gt;c.b8[2]); PUTPAD(ctxt-&gt;c.b8[3]);
<span class="lineNum">     195 </span>            :     PUTPAD(ctxt-&gt;c.b8[4]); PUTPAD(ctxt-&gt;c.b8[5]);
<span class="lineNum">     196 </span>            :     PUTPAD(ctxt-&gt;c.b8[6]); PUTPAD(ctxt-&gt;c.b8[7]);
<span class="lineNum">     197 </span>            : #else
<span class="lineNum">     198 </span><span class="lineCov">     111838 :     PUTPAD(ctxt-&gt;c.b8[7]); PUTPAD(ctxt-&gt;c.b8[6]);</span>
<span class="lineNum">     199 </span><span class="lineCov">     111838 :     PUTPAD(ctxt-&gt;c.b8[5]); PUTPAD(ctxt-&gt;c.b8[4]);</span>
<span class="lineNum">     200 </span><span class="lineCov">     111838 :     PUTPAD(ctxt-&gt;c.b8[3]); PUTPAD(ctxt-&gt;c.b8[2]);</span>
<span class="lineNum">     201 </span><span class="lineCov">     111838 :     PUTPAD(ctxt-&gt;c.b8[1]); PUTPAD(ctxt-&gt;c.b8[0]);</span>
<span class="lineNum">     202 </span>            : #endif
<span class="lineNum">     203 </span><span class="lineCov">     111838 : }</span>
<a name="204"><span class="lineNum">     204 </span>            : </a>
<span class="lineNum">     205 </span>            : void
<span class="lineNum">     206 </span><span class="lineCov">     228161 : sha1_loop(struct sha1_ctxt *ctxt, const void *input, size_t len)</span>
<span class="lineNum">     207 </span>            : {
<span class="lineNum">     208 </span><span class="lineCov">     228161 :     const unsigned char *input_c = input;</span>
<span class="lineNum">     209 </span>            :     size_t gaplen;
<span class="lineNum">     210 </span>            :     size_t gapstart;
<span class="lineNum">     211 </span>            :     size_t off;
<span class="lineNum">     212 </span>            :     size_t copysiz;
<span class="lineNum">     213 </span>            : 
<span class="lineNum">     214 </span><span class="lineCov">     228161 :     off = 0;</span>
<span class="lineNum">     215 </span>            : 
<span class="lineNum">     216 </span><span class="lineCov">    1368734 :     while (off &lt; len) {</span>
<span class="lineNum">     217 </span><span class="lineCov">     912412 :         gapstart = COUNT % 64;</span>
<span class="lineNum">     218 </span><span class="lineCov">     912412 :         gaplen = 64 - gapstart;</span>
<span class="lineNum">     219 </span>            : 
<span class="lineNum">     220 </span><span class="lineCov">     912412 :         copysiz = (gaplen &lt; len - off) ? gaplen : len - off;</span>
<span class="lineNum">     221 </span><span class="lineCov">     912412 :         memmove(&amp;ctxt-&gt;m.b8[gapstart], &amp;input_c[off], copysiz);</span>
<span class="lineNum">     222 </span><span class="lineCov">     912412 :         COUNT += copysiz;</span>
<span class="lineNum">     223 </span><span class="lineCov">     912412 :         COUNT %= 64;</span>
<span class="lineNum">     224 </span><span class="lineCov">     912412 :         ctxt-&gt;c.b64[0] += copysiz * 8;</span>
<span class="lineNum">     225 </span><span class="lineCov">     912412 :         if (COUNT % 64 == 0)</span>
<span class="lineNum">     226 </span><span class="lineCov">     793679 :             sha1_step(ctxt);</span>
<span class="lineNum">     227 </span><span class="lineCov">     912412 :         off += copysiz;</span>
<span class="lineNum">     228 </span>            :     }
<span class="lineNum">     229 </span><span class="lineCov">     228161 : }</span>
<a name="230"><span class="lineNum">     230 </span>            : </a>
<span class="lineNum">     231 </span>            : void
<span class="lineNum">     232 </span><span class="lineCov">     111838 : sha1_result(struct sha1_ctxt *ctxt, void *digest0)</span>
<span class="lineNum">     233 </span>            : {
<span class="lineNum">     234 </span>            :     uint8_t *digest;
<span class="lineNum">     235 </span>            : 
<span class="lineNum">     236 </span><span class="lineCov">     111838 :     digest = (uint8_t *)digest0;</span>
<span class="lineNum">     237 </span><span class="lineCov">     111838 :     sha1_pad(ctxt);</span>
<span class="lineNum">     238 </span>            : #ifdef WORDS_BIGENDIAN
<span class="lineNum">     239 </span>            :     memmove(digest, &amp;ctxt-&gt;h.b8[0], 20);
<span class="lineNum">     240 </span>            : #else
<span class="lineNum">     241 </span><span class="lineCov">     111838 :     digest[0] = ctxt-&gt;h.b8[3]; digest[1] = ctxt-&gt;h.b8[2];</span>
<span class="lineNum">     242 </span><span class="lineCov">     111838 :     digest[2] = ctxt-&gt;h.b8[1]; digest[3] = ctxt-&gt;h.b8[0];</span>
<span class="lineNum">     243 </span><span class="lineCov">     111838 :     digest[4] = ctxt-&gt;h.b8[7]; digest[5] = ctxt-&gt;h.b8[6];</span>
<span class="lineNum">     244 </span><span class="lineCov">     111838 :     digest[6] = ctxt-&gt;h.b8[5]; digest[7] = ctxt-&gt;h.b8[4];</span>
<span class="lineNum">     245 </span><span class="lineCov">     111838 :     digest[8] = ctxt-&gt;h.b8[11]; digest[9] = ctxt-&gt;h.b8[10];</span>
<span class="lineNum">     246 </span><span class="lineCov">     111838 :     digest[10] = ctxt-&gt;h.b8[9]; digest[11] = ctxt-&gt;h.b8[8];</span>
<span class="lineNum">     247 </span><span class="lineCov">     111838 :     digest[12] = ctxt-&gt;h.b8[15]; digest[13] = ctxt-&gt;h.b8[14];</span>
<span class="lineNum">     248 </span><span class="lineCov">     111838 :     digest[14] = ctxt-&gt;h.b8[13]; digest[15] = ctxt-&gt;h.b8[12];</span>
<span class="lineNum">     249 </span><span class="lineCov">     111838 :     digest[16] = ctxt-&gt;h.b8[19]; digest[17] = ctxt-&gt;h.b8[18];</span>
<span class="lineNum">     250 </span><span class="lineCov">     111838 :     digest[18] = ctxt-&gt;h.b8[17]; digest[19] = ctxt-&gt;h.b8[16];</span>
<span class="lineNum">     251 </span>            : #endif
<span class="lineNum">     252 </span><span class="lineCov">     111838 :     safe_memset(ctxt, 0, sizeof(struct sha1_ctxt));</span>
<a name="253"><span class="lineNum">     253 </span><span class="lineCov">     111838 : }</span></a>
<span class="lineNum">     254 </span>            : 
<span class="lineNum">     255 </span><span class="lineCov">         12 : void sha1_get_digest(const void *data, size_t size,</span>
<span class="lineNum">     256 </span>            :              unsigned char result[STATIC_ARRAY SHA1_RESULTLEN])
<span class="lineNum">     257 </span>            : {
<span class="lineNum">     258 </span>            :     struct sha1_ctxt ctx;
<span class="lineNum">     259 </span>            : 
<span class="lineNum">     260 </span><span class="lineCov">         12 :     sha1_init(&amp;ctx);</span>
<span class="lineNum">     261 </span><span class="lineCov">         12 :     sha1_loop(&amp;ctx, data, size);</span>
<span class="lineNum">     262 </span><span class="lineCov">         12 :     sha1_result(&amp;ctx, result);</span>
<a name="263"><span class="lineNum">     263 </span><span class="lineCov">         12 : }</span></a>
<span class="lineNum">     264 </span>            : 
<span class="lineNum">     265 </span><span class="lineCov">     107856 : static void hash_method_init_sha1(void *context)</span>
<span class="lineNum">     266 </span>            : {
<a name="267"><span class="lineNum">     267 </span><span class="lineCov">     107856 :     sha1_init(context);</span></a>
<span class="lineNum">     268 </span><span class="lineCov">     107856 : }</span>
<span class="lineNum">     269 </span><span class="lineCov">     219652 : static void hash_method_loop_sha1(void *context, const void *data, size_t size)</span>
<span class="lineNum">     270 </span>            : {
<span class="lineNum">     271 </span><span class="lineCov">     219652 :     sha1_loop(context, data, size);</span>
<a name="272"><span class="lineNum">     272 </span><span class="lineCov">     219652 : }</span></a>
<span class="lineNum">     273 </span>            : 
<span class="lineNum">     274 </span><span class="lineCov">     107688 : static void hash_method_result_sha1(void *context, unsigned char *result_r)</span>
<span class="lineNum">     275 </span>            : {
<span class="lineNum">     276 </span><span class="lineCov">     107688 :     sha1_result(context, result_r);</span>
<span class="lineNum">     277 </span><span class="lineCov">     107688 : }</span>
<span class="lineNum">     278 </span>            : 
<span class="lineNum">     279 </span>            : const struct hash_method hash_method_sha1 = {
<span class="lineNum">     280 </span>            :     &quot;sha1&quot;,
<span class="lineNum">     281 </span>            :     sizeof(struct sha1_ctxt),
<span class="lineNum">     282 </span>            :     SHA1_RESULTLEN,
<span class="lineNum">     283 </span>            : 
<span class="lineNum">     284 </span>            :     hash_method_init_sha1,
<span class="lineNum">     285 </span>            :     hash_method_loop_sha1,
<span class="lineNum">     286 </span>            :     hash_method_result_sha1
<span class="lineNum">     287 </span>            : };
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.10</a></td></tr>
  </table>
  <br>

</body>
</html>
